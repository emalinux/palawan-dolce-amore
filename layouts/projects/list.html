{{ define "main" }}

{{ if .Params.year }}
  <!-- PAGINA ANNO: es. /projects/2019/ -->

  <div class="page-container projects-year-page">

    <header class="projects-year-header">
      <h1>{{ .Title }}</h1>
      {{ with .Params.description }}
        <p class="projects-year-intro">{{ . }}</p>
      {{ end }}
    </header>

    <!-- Slider evidenza -->
    <section class="projects-slider-section">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

      <div class="swiper projects-swiper">
        <div class="swiper-wrapper">
          {{ range .Params.featuredPhotos }}
          <div class="swiper-slide">
            <img src="{{ . }}" alt="" loading="lazy" />
          </div>
          {{ end }}
        </div>

        <div class="swiper-pagination"></div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
      <script>
        document.addEventListener("DOMContentLoaded", function () {
          if (document.querySelector(".projects-swiper")) {
            new Swiper(".projects-swiper", {
              loop: true,
              pagination: { el: ".swiper-pagination", clickable: true },
              navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
              },
            });
          }
        });
      </script>
    </section>

    <!-- Griglia full gallery con lightbox -->
    <section class="projects-gallery-section">
      <h2 class="projects-gallery-title">Full photo gallery</h2>

      <div class="projects-gallery-grid">
        {{ $dir := .Params.galleryDir }}
        {{ range readDir (printf "static%s" $dir) }}
          {{ if not .IsDir }}
            {{ $path := printf "%s%s" $dir .Name }}
            <a href="{{ $path }}" class="glightbox projects-gallery-item">
              <img src="{{ $path }}" alt="" loading="lazy" />
            </a>
          {{ end }}
        {{ end }}
      </div>
    </section>

  </div>

{{ else }}
  <!-- PAGINA ROOT /projects/ -->

  <div class="page-container projects-index-page">
    <header class="projects-index-header">
      <h1>{{ .Title }}</h1>
      <div class="projects-index-intro">
        {{ .Content }}
      </div>
    </header>

    <section class="projects-year-section">
      <h2 class="projects-year-heading">Explore the projects by year</h2>
      <ul class="projects-year-list">
        {{ range .Pages.ByParam "year" }}
          <li>
            <a href="{{ .RelPermalink }}">{{ .Params.year }}</a>
          </li>
        {{ end }}
      </ul>
    </section>
  </div>

{{ end }}

{{ end }}